apiVersion: batch/v1
kind: Job
metadata:
  name: disk-wipe
  namespace: rook-ceph  # or any namespace
spec:
  template:
    spec:
      restartPolicy: Never
      nodeName: widagoth  # Target specific node
      containers:
        - name: disk-wipe
          image: alpine:latest
          command:
            - /bin/sh
            - -c
            - |
              set -ex
              apk update && apk upgrade
              apk add --no-cache wipefs sgdisk coreutils nvme-cli
              DISK="/dev/disk/by-id/usb-ROG_ESD-S1C_LBD0AP002573-0:0" # Change to your disk

              echo "Wiping disk: $DISK"

              # Remove filesystem signatures
              wipefs -af $DISK

              # Zap GPT and MBR
              sgdisk --zap-all $DISK

              # Optional: zero first/last MB for good measure
              dd if=/dev/zero of=$DISK bs=5M count=100 oflag=direct,dsync
              dd if=/dev/zero of=$DISK bs=1M seek=$(( $(blockdev --getsz $DISK) / 2048 - 100 )) count=100 oflag=direct,dsync

              echo "Disk $DISK wiped successfully"
          securityContext:
            privileged: true
          volumeMounts:
            - name: dev
              mountPath: /dev
      volumes:
        - name: dev
          hostPath:
            path: /dev